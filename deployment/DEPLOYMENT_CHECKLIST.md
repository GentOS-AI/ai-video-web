# âœ… éƒ¨ç½²æ£€æŸ¥æ¸…å•

åœ¨éƒ¨ç½²å‰ã€éƒ¨ç½²ä¸­å’Œéƒ¨ç½²åä½¿ç”¨æ­¤æ¸…å•ç¡®ä¿ä¸€åˆ‡é…ç½®æ­£ç¡®ã€‚

---

## ğŸ“‹ éƒ¨ç½²å‰å‡†å¤‡

### åŸŸåå’Œ DNS
- [ ] å·²è´­ä¹°åŸŸå `adsvideo.co`
- [ ] å·²æ·»åŠ  A è®°å½•æŒ‡å‘æœåŠ¡å™¨ IP
- [ ] DNS å·²ç”Ÿæ•ˆ (ä½¿ç”¨ `dig adsvideo.co +short` éªŒè¯)

### æœåŠ¡å™¨
- [ ] æœåŠ¡å™¨ç³»ç»Ÿ: Ubuntu 22.04 LTS
- [ ] æœåŠ¡å™¨é…ç½®: æœ€ä½ 4 æ ¸ 8GB RAM
- [ ] ç£ç›˜ç©ºé—´: æœ€ä½ 50GB å¯ç”¨
- [ ] SSH è®¿é—®å·²é…ç½®
- [ ] æœåŠ¡å™¨å…¬ç½‘ IP å·²çŸ¥

### API å¯†é’¥å‡†å¤‡
- [ ] Google OAuth å®¢æˆ·ç«¯ ID å’Œå¯†é’¥å·²è·å–
- [ ] OpenAI API Key å·²è·å– (Sora è®¿é—®æƒé™)
- [ ] Gemini API Key å·²è·å–
- [ ] ç”Ÿæˆ JWT Secret Key: `openssl rand -hex 32`
- [ ] å‡†å¤‡å¼ºå¯†ç ç”¨äºæ•°æ®åº“ (16+ å­—ç¬¦)

### ä»£ç å‡†å¤‡
- [ ] å‰ç«¯ä»£ç å·²æ„å»ºæµ‹è¯• (`npm run build`)
- [ ] åç«¯ä»£ç å·²æµ‹è¯•
- [ ] æ‰€æœ‰ç¯å¢ƒå˜é‡å·²è®°å½•
- [ ] æ•°æ®åº“è¿ç§»æ–‡ä»¶å·²å‡†å¤‡

---

## ğŸ”§ éƒ¨ç½²ä¸­æ£€æŸ¥

### é˜¶æ®µ 1: ç³»ç»Ÿç¯å¢ƒ
- [ ] ç³»ç»Ÿå·²æ›´æ–° (`apt update && apt upgrade`)
- [ ] Node.js 20.x å·²å®‰è£… (`node --version`)
- [ ] Python 3.11 å·²å®‰è£… (`python3.11 --version`)
- [ ] PostgreSQL 15 å·²å®‰è£…
- [ ] Redis å·²å®‰è£…å¹¶è¿è¡Œ (`redis-cli ping`)
- [ ] Nginx å·²å®‰è£…
- [ ] Certbot å·²å®‰è£…
- [ ] é˜²ç«å¢™å·²é…ç½® (å…è®¸ 80/443/SSH)

### é˜¶æ®µ 2: æ•°æ®åº“
- [ ] PostgreSQL æ•°æ®åº“å·²åˆ›å»º (`aivideo_prod`)
- [ ] æ•°æ®åº“ç”¨æˆ·å·²åˆ›å»º (`aivideo_user`)
- [ ] ç”¨æˆ·æƒé™å·²æˆäºˆ
- [ ] æ•°æ®åº“å¯†ç å·²è®¾ç½® (å¼ºå¯†ç )
- [ ] Redis æœåŠ¡å·²å¯åŠ¨å¹¶è‡ªå¯åŠ¨

### é˜¶æ®µ 3: ä»£ç éƒ¨ç½²
- [ ] åº”ç”¨ç”¨æˆ·å·²åˆ›å»º (`aivideo`)
- [ ] éƒ¨ç½²ç›®å½•å·²åˆ›å»º (`/var/www/aivideo`)
- [ ] ä»£ç å·²ä¸Šä¼ åˆ°æœåŠ¡å™¨
- [ ] ç›®å½•æƒé™å·²è®¾ç½® (`chown aivideo:aivideo`)
- [ ] åç«¯è™šæ‹Ÿç¯å¢ƒå·²åˆ›å»º
- [ ] åç«¯ä¾èµ–å·²å®‰è£… (åŒ…æ‹¬ `gunicorn` å’Œ `psycopg2-binary`)
- [ ] å‰ç«¯ä¾èµ–å·²å®‰è£…
- [ ] å‰ç«¯å·²æ„å»º (`npm run build` æˆåŠŸ)

### é˜¶æ®µ 4: é…ç½®æ–‡ä»¶
- [ ] åç«¯ `.env` å·²é…ç½®
  - [ ] `DATABASE_URL` å·²å¡«å†™ (åŒ…å«æ­£ç¡®å¯†ç )
  - [ ] `GOOGLE_CLIENT_ID` å·²å¡«å†™
  - [ ] `GOOGLE_CLIENT_SECRET` å·²å¡«å†™
  - [ ] `JWT_SECRET_KEY` å·²ç”Ÿæˆå¹¶å¡«å†™
  - [ ] `OPENAI_API_KEY` å·²å¡«å†™
  - [ ] `GEMINI_API_KEY` å·²å¡«å†™
  - [ ] `USE_MOCK_SORA=false` (ç”Ÿäº§ç¯å¢ƒ)
  - [ ] `DEBUG=false` (ç”Ÿäº§ç¯å¢ƒ)
- [ ] å‰ç«¯ `.env.production.local` å·²é…ç½®
  - [ ] `NEXT_PUBLIC_API_URL=https://adsvideo.co/api/v1`
  - [ ] `NEXT_PUBLIC_GOOGLE_CLIENT_ID` å·²å¡«å†™
- [ ] æ•°æ®åº“è¿ç§»å·²è¿è¡Œ (`alembic upgrade head`)

### é˜¶æ®µ 5: ç›®å½•åˆ›å»º
- [ ] ä¸Šä¼ ç›®å½•å·²åˆ›å»º (`/var/www/aivideo/backend/uploads`)
- [ ] è§†é¢‘ç›®å½•å·²åˆ›å»º (`/var/www/aivideo/backend/uploads/videos`)
- [ ] æ—¥å¿—ç›®å½•å·²åˆ›å»º (`/var/log/aivideo`)
- [ ] Celery PID ç›®å½•å·²åˆ›å»º (`/var/run/celery`)
- [ ] å¤‡ä»½ç›®å½•å·²åˆ›å»º (`/var/backups/aivideo`)
- [ ] æ‰€æœ‰ç›®å½•æƒé™å·²æ­£ç¡®è®¾ç½®

### é˜¶æ®µ 6: Systemd æœåŠ¡
- [ ] æœåŠ¡æ–‡ä»¶å·²å¤åˆ¶åˆ° `/etc/systemd/system/`
- [ ] Systemd å·²é‡æ–°åŠ è½½ (`daemon-reload`)
- [ ] API æœåŠ¡å·²å¯åŠ¨ (`aivideo-api`)
- [ ] Celery æœåŠ¡å·²å¯åŠ¨ (`aivideo-celery`)
- [ ] Frontend æœåŠ¡å·²å¯åŠ¨ (`aivideo-frontend`)
- [ ] æ‰€æœ‰æœåŠ¡å·²è®¾ç½®å¼€æœºè‡ªå¯åŠ¨ (`enable`)
- [ ] æ‰€æœ‰æœåŠ¡çŠ¶æ€æ­£å¸¸ (`systemctl status`)

### é˜¶æ®µ 7: Nginx é…ç½®
- [ ] Nginx é…ç½®æ–‡ä»¶å·²å¤åˆ¶
- [ ] ä¸´æ—¶é…ç½®å·²å¯ç”¨ (ç”¨äº SSL éªŒè¯)
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡ (`nginx -t`)
- [ ] Nginx å·²é‡å¯

### é˜¶æ®µ 8: SSL è¯ä¹¦
- [ ] Let's Encrypt è¯ä¹¦å·²ç”³è¯·æˆåŠŸ
- [ ] è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²æµ‹è¯• (`certbot renew --dry-run`)
- [ ] ç”Ÿäº§ Nginx é…ç½®å·²å¯ç”¨
- [ ] HTTPS è®¿é—®æ­£å¸¸

### é˜¶æ®µ 9: å¤‡ä»½å’Œç›‘æ§
- [ ] å¤‡ä»½è„šæœ¬æƒé™å·²è®¾ç½®
- [ ] å¤‡ä»½è„šæœ¬ä¸­çš„å¯†ç å·²é…ç½®
- [ ] Cron å®šæ—¶ä»»åŠ¡å·²é…ç½®
  - [ ] æ•°æ®åº“å¤‡ä»½ (æ¯å¤© 2:00)
  - [ ] ä¸Šä¼ æ–‡ä»¶å¤‡ä»½ (æ¯å¤© 3:00)
  - [ ] å¥åº·æ£€æŸ¥ (æ¯ 5 åˆ†é’Ÿ)
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®

---

## âœ… éƒ¨ç½²åéªŒè¯

### æœåŠ¡çŠ¶æ€æ£€æŸ¥
- [ ] Nginx è¿è¡Œæ­£å¸¸
  ```bash
  sudo systemctl status nginx
  ```
- [ ] PostgreSQL è¿è¡Œæ­£å¸¸
  ```bash
  sudo systemctl status postgresql
  ```
- [ ] Redis è¿è¡Œæ­£å¸¸
  ```bash
  redis-cli ping
  ```
- [ ] API æœåŠ¡è¿è¡Œæ­£å¸¸
  ```bash
  sudo systemctl status aivideo-api
  ```
- [ ] Celery æœåŠ¡è¿è¡Œæ­£å¸¸
  ```bash
  sudo systemctl status aivideo-celery
  ```
- [ ] Frontend æœåŠ¡è¿è¡Œæ­£å¸¸
  ```bash
  sudo systemctl status aivideo-frontend
  ```

### ç«¯å£ç›‘å¬æ£€æŸ¥
- [ ] ç«¯å£ 80/443 å·²ç›‘å¬ (Nginx)
  ```bash
  sudo netstat -tulpn | grep nginx
  ```
- [ ] ç«¯å£ 3000 å·²ç›‘å¬ (Next.js)
  ```bash
  sudo netstat -tulpn | grep 3000
  ```
- [ ] ç«¯å£ 8000 å·²ç›‘å¬ (FastAPI)
  ```bash
  sudo netstat -tulpn | grep 8000
  ```

### API ç«¯ç‚¹æµ‹è¯•
- [ ] å¥åº·æ£€æŸ¥ç«¯ç‚¹æ­£å¸¸
  ```bash
  curl https://adsvideo.co/api/v1/health
  # åº”è¯¥è¿”å›: {"status":"healthy"}
  ```
- [ ] API æ–‡æ¡£å¯è®¿é—®
  ```bash
  curl -I https://adsvideo.co/docs
  # åº”è¯¥è¿”å›: HTTP/2 200
  ```

### ç½‘ç«™åŠŸèƒ½æµ‹è¯•
- [ ] HTTPS ä¸»é¡µå¯è®¿é—® (`https://adsvideo.co`)
- [ ] SSL è¯ä¹¦æœ‰æ•ˆ (æµè§ˆå™¨æ˜¾ç¤ºé”å›¾æ ‡)
- [ ] HTTP è‡ªåŠ¨è·³è½¬åˆ° HTTPS
- [ ] Google OAuth ç™»å½•æ­£å¸¸
- [ ] ç”¨æˆ·æ³¨å†Œ/ç™»å½•æˆåŠŸ
- [ ] å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] AI è„šæœ¬ç”ŸæˆåŠŸèƒ½æ­£å¸¸
- [ ] è§†é¢‘ç”Ÿæˆæäº¤æˆåŠŸ
- [ ] SSE å®æ—¶è¿›åº¦æ˜¾ç¤ºæ­£å¸¸
- [ ] è§†é¢‘ç”Ÿæˆå®Œæˆ
- [ ] è§†é¢‘æ’­æ”¾æ­£å¸¸
- [ ] "æˆ‘çš„è§†é¢‘" é¡µé¢æ­£å¸¸
- [ ] è§†é¢‘ä¸‹è½½åŠŸèƒ½æ­£å¸¸
- [ ] è§†é¢‘åˆ é™¤åŠŸèƒ½æ­£å¸¸
- [ ] å¤šè¯­è¨€åˆ‡æ¢æ­£å¸¸

### æ—¥å¿—æ£€æŸ¥
- [ ] æ— è‡´å‘½é”™è¯¯
  ```bash
  sudo journalctl -u aivideo-api -n 50 --no-pager
  sudo journalctl -u aivideo-celery -n 50 --no-pager
  sudo journalctl -u aivideo-frontend -n 50 --no-pager
  sudo tail -n 50 /var/log/nginx/adsvideo-error.log
  ```

### å¥åº·æ£€æŸ¥è„šæœ¬
- [ ] å¥åº·æ£€æŸ¥è„šæœ¬è¿è¡Œæ— é”™è¯¯
  ```bash
  sudo -u aivideo /var/www/aivideo/deployment/scripts/health-check.sh
  ```
- [ ] æ‰€æœ‰æ£€æŸ¥é¡¹é€šè¿‡

### æ€§èƒ½æ£€æŸ¥
- [ ] é¡µé¢åŠ è½½é€Ÿåº¦ < 3 ç§’
- [ ] API å“åº”æ—¶é—´ < 500ms
- [ ] CPU ä½¿ç”¨ç‡ < 70%
- [ ] å†…å­˜ä½¿ç”¨ç‡ < 80%
- [ ] ç£ç›˜ç©ºé—´ > 20% å¯ç”¨

### å¤‡ä»½éªŒè¯
- [ ] æ•°æ®åº“å¤‡ä»½è„šæœ¬å¯æ‰§è¡Œ
  ```bash
  sudo -u aivideo /var/www/aivideo/deployment/scripts/backup-database.sh
  ```
- [ ] å¤‡ä»½æ–‡ä»¶å·²ç”Ÿæˆ
  ```bash
  ls -lh /var/backups/aivideo/database/
  ```
- [ ] ä¸Šä¼ æ–‡ä»¶å¤‡ä»½è„šæœ¬å¯æ‰§è¡Œ
  ```bash
  sudo -u aivideo /var/www/aivideo/deployment/scripts/backup-uploads.sh
  ```

---

## ğŸ”’ å®‰å…¨æ£€æŸ¥

- [ ] æ‰€æœ‰å¯†ç éƒ½æ˜¯å¼ºå¯†ç  (16+ å­—ç¬¦)
- [ ] `.env` æ–‡ä»¶æƒé™ä¸º 600
- [ ] æœåŠ¡ä¸ä»¥ root ç”¨æˆ·è¿è¡Œ
- [ ] é˜²ç«å¢™åªå¼€æ”¾å¿…è¦ç«¯å£ (22, 80, 443)
- [ ] PostgreSQL åªç›‘å¬æœ¬åœ°è¿æ¥
- [ ] Redis åªç›‘å¬æœ¬åœ°è¿æ¥
- [ ] SSH å¯†é’¥ç™»å½•å·²é…ç½® (å¯é€‰)
- [ ] Fail2Ban å·²å®‰è£… (å¯é€‰)
- [ ] è‡ªåŠ¨å®‰å…¨æ›´æ–°å·²å¯ç”¨ (å¯é€‰)

---

## ğŸ“Š ç›‘æ§è®¾ç½®

- [ ] æœåŠ¡å™¨èµ„æºç›‘æ§å·²é…ç½®
- [ ] é”™è¯¯æ—¥å¿—å‘Šè­¦å·²é…ç½® (å¯é€‰)
- [ ] SSL è¯ä¹¦åˆ°æœŸæé†’å·²é…ç½® (Certbot è‡ªåŠ¨)
- [ ] ç£ç›˜ç©ºé—´ç›‘æ§å·²é…ç½® (å¥åº·æ£€æŸ¥è„šæœ¬)

---

## ğŸ“ æ–‡æ¡£æ£€æŸ¥

- [ ] æ‰€æœ‰å¯†ç å·²å®‰å…¨ä¿å­˜
- [ ] API å¯†é’¥å·²å¤‡ä»½
- [ ] æœåŠ¡å™¨ IP å·²è®°å½•
- [ ] åŸŸåç®¡ç†è´¦å·å·²è®°å½•
- [ ] Google Cloud é¡¹ç›®ä¿¡æ¯å·²è®°å½•

---

## ğŸ¯ é¦–æ¬¡éƒ¨ç½²å 24 å°æ—¶æ£€æŸ¥

- [ ] æ£€æŸ¥ Cron ä»»åŠ¡æ˜¯å¦æ‰§è¡Œ
  ```bash
  ls -lt /var/backups/aivideo/database/
  tail -f /var/log/aivideo/health-check.log
  ```
- [ ] æ£€æŸ¥æ—¥å¿—è½®è½¬æ˜¯å¦å·¥ä½œ
  ```bash
  sudo logrotate -d /etc/logrotate.d/aivideo
  ```
- [ ] æ£€æŸ¥ SSL è¯ä¹¦ç»­æœŸ Timer
  ```bash
  sudo systemctl list-timers | grep certbot
  ```
- [ ] ç›‘æ§æœåŠ¡å™¨èµ„æºä½¿ç”¨è¶‹åŠ¿
  ```bash
  htop
  df -h
  ```

---

## ğŸ”„ æ›´æ–°éƒ¨ç½²æ£€æŸ¥æ¸…å•

å½“è¿›è¡Œä»£ç æ›´æ–°æ—¶:

- [ ] ä»£ç å·²å¤‡ä»½
- [ ] æ•°æ®åº“å·²å¤‡ä»½
- [ ] æ–°ä»£ç å·²ä¸Šä¼ 
- [ ] åç«¯ä¾èµ–å·²æ›´æ–° (`pip install -r requirements.txt`)
- [ ] å‰ç«¯ä¾èµ–å·²æ›´æ–° (`npm ci`)
- [ ] æ•°æ®åº“è¿ç§»å·²è¿è¡Œ (`alembic upgrade head`)
- [ ] å‰ç«¯å·²é‡æ–°æ„å»º (`npm run build`)
- [ ] æœåŠ¡å·²é‡å¯
- [ ] åŠŸèƒ½æµ‹è¯•é€šè¿‡
- [ ] æ— é”™è¯¯æ—¥å¿—

---

## ğŸ†˜ å›æ»šè®¡åˆ’

å¦‚æœéƒ¨ç½²å¤±è´¥,å‡†å¤‡å›æ»š:

- [ ] çŸ¥é“å¦‚ä½•æ¢å¤æ•°æ®åº“å¤‡ä»½
  ```bash
  sudo -u aivideo /var/www/aivideo/deployment/scripts/restore-database.sh \
      /var/backups/aivideo/database/æœ€æ–°å¤‡ä»½.sql.gz
  ```
- [ ] çŸ¥é“å¦‚ä½•åˆ‡æ¢åˆ°ä¸Šä¸€ä¸ªä»£ç ç‰ˆæœ¬
  ```bash
  cd /var/www/aivideo
  git checkout <previous-commit>
  ```
- [ ] çŸ¥é“å¦‚ä½•æŸ¥çœ‹æ—¥å¿—å®šä½é—®é¢˜
- [ ] æœ‰æŠ€æœ¯æ”¯æŒè”ç³»æ–¹å¼

---

## âœ… æœ€ç»ˆç¡®è®¤

- [ ] æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ€§èƒ½ç¬¦åˆé¢„æœŸ
- [ ] æ— å®‰å…¨éšæ‚£
- [ ] ç›‘æ§å’Œå¤‡ä»½å·²é…ç½®
- [ ] å›¢é˜Ÿæˆå‘˜å·²åŸ¹è®­
- [ ] æ–‡æ¡£å·²æ›´æ–°

---

**ğŸ‰ æ­å–œ! éƒ¨ç½²å®Œæˆ!**

å®šæœŸæ£€æŸ¥:
- æ¯å‘¨æŸ¥çœ‹å¥åº·æ£€æŸ¥æ—¥å¿—
- æ¯æœˆæ£€æŸ¥å¤‡ä»½å®Œæ•´æ€§
- æ¯å­£åº¦æ›´æ–°ä¾èµ–å’Œç³»ç»Ÿ

**æŠ€æœ¯æ”¯æŒ**: æŸ¥çœ‹ [DEPLOYMENT_GUIDE.md](../DEPLOYMENT_GUIDE.md) æˆ– [deployment/README.md](README.md)
